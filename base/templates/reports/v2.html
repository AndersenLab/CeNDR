{% extends "_layouts/default.html" %}


{% block custom_head %}

<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />

{% endblock %}

{% block style %}
<style>
.report {
  width: 100%;
} 

.height-report {
  height: 60%;
  width: 60%;
  display: block;
  margin-left: auto;
  margin-right: auto
}

#report_nav.affix {
    position: fixed;
    top: 0px;
    left: 0px;
    width: 100%;
}



/* Keep Header Scroll */
#variant_list table {
    width: 100%;
}

#variant_list thead, #variant_list tbody, #variant_list tr, #variant_list td, #variant_list th { display: block; }

#variant_list tr:after {
    content: ' ';
    display: block;
    visibility: hidden;
    clear: both;
}

#gene_list thead th, #variant_list thead th {
    height: 30px;
    /*text-align: left;*/
}

#gene_list tbody, #variant_list tbody {
    height: 500px;
    overflow-y: auto;
}

#gene_list tbody td, #gene_list thead th, #variant_list tbody td, #variant_list thead th {
    width: 16.66%;
    float: left;
}

.meta-table td:nth-child(1) {
    font-weight: bold;
}

.meta-table td:nth-child(2) {
    text-align: right;
}

</style>
{% endblock %}

{% block content %}

<div class="row">
    <div class='col-md-12'>
        <h4>Traits</h4>
        {# Traits #}
            {% for trait in report.trait_list %} 

            <a href="{{ url_for('mapping.report', report_slug = report.report_slug, trait_name = trait) }}" type="button" class="btn btn-sm {% if trait_name == trait %} btn-primary {% else %} btn-link {% endif %}"><strong>{{ trait }}</strong></a>     
        {% endfor %}
        <br /><br />
    </div>{# /col-md-12 #}
</div>{# /row #}


<div class="panel panel-default">
    <div class="panel-body">
        <div class="row">
            <div class='col-md-12'>
            <h5>Report summary</h5>
            </div>
        </div>
        <div class='row'>
            <div class='col-md-6'>
                {% from "macros.html" import render_table %}
                {% set rows = [['Report Name', report.report_name],
                               ['Trait Name', trait.trait_name],
                               ['Data release', trait.version_link()],
                               ['CeNDR version', trait.version_cendr],
                               ['Report version', trait.version_report],
                               ['cegwas version', trait.version_cegwas]] %}
                {{ render_table(header=None, rows=rows, table_class='table-striped table-bordered meta-table') }}

                {% set rows = [['Strains for trait "{}"'.format(trait.trait_name), strain_count],
                               ['Traits', report.trait_list|length]] %}
                {{ render_table(header=None, rows=rows, table_class='table-striped table-bordered') }}
            </div>{# /col-md-6 #}
            <div class='col-md-6'>

                <table class='table table-striped table-bordered meta-table'>
                    <tbody>
                        <tr>
                            <td>Status</td>
                            <td>{{ trait.run_status }}</td>
                        </tr>
                        <tr>
                            <td>Submitted</td>
                            <td>{{ trait.created_on.strftime("%Y-%m-%d&nbsp;&nbsp; %H:%m:%S")|safe }} UTC</td>
                        </tr>
                        <tr>
                            <td>Started</td>
                            <td>{% if trait.started_on %}
                                {{ trait.started_on.strftime("%Y-%m-%d&nbsp;&nbsp; %H:%m:%S")|safe }} UTC
                            {% endif %}</td>
                        </tr>
                        <tr>
                            <td>Completed </td>
                            <td>{% if trait.completed_on %}
                                {{ trait.completed_on.strftime("%Y-%m-%d&nbsp;&nbsp; %H:%m:%S")|safe }} UTC
                            {% endif %}</td>
                        </tr>
                        <tr>
                            {% set duration = trait.duration() %}
                            <td>Duration</td>
                            <td>{% if duration %}{{ trait.duration() }}{% endif %}</td>
                        </tr>
                        <tr>
                            <td>Log</td>
                            <td><a href='javascript:$(".log").slideToggle();'>View Log</a></td>
                        </tr>
                    </body>
                </table>


                <table class='table table-striped table-bordered meta-table'>
                    <tbody>
                        <tr>
                            <td>Report Mode</td>
                            <td>{% if report.is_public %}public{% else %}private{% endif %}</td>
                        </tr>
                        <tr>
                            <td>Share</td>
                            <td>{% if report.is_public %}
                                    {{ request.url_root.strip('/') }}{{ url_for('mapping.report', report_slug=report.report_slug, trait_name=trait_name) }}
                                {% else %}
                                    {{ request.url_root.strip('/') }}{{ url_for('mapping.report', report_slug=report.secret_hash, trait_name=trait_name) }}
                                {% endif %}
                            </td>
                        </tr>
                    </tbody>
                </table>

            </div>
        </div>{# /row #}

        <div class="row">
            <div class='col-md-12'>
            <h5>Data</h5>
            </div>
        </div>
        <div class='row'>
            <div class='col-md-6'>

            </div>
        </div>


    </div>{# /panel-body #}
</div>{# /panel #}



<div class='log'>
    <h4>Log</h4>
    <div class='well'>
        {% for line in trait.get_formatted_task_log() %}
            {{ line }}<br />
        {% endfor %}
    </div>
</div>



<h2>Phenotype</h2>
{{ plot|safe }}



{% endblock %}
