{% extends "_layouts/default.html" %}


{% block custom_head %}
{% endblock %}


{% block style %}
{% endblock %}

{% block content %}


<div class="row">
      <div class="col-md-12">

      <div class="btn-group" role="group">
        {% for trait in report_data %} 

          <a href="{{ url_for('trait_view', report_slug= trait.report_slug, trait_slug = trait.trait_slug) }}" type="button" class="btnbtn-secondary btn-sm {% if trait.trait_slug == trait_slug %} btn-primary {% endif %}">{{ trait.trait_name }}</a>
          
        {% endfor %}

        </div>
        <hr />
      </div>
</div>

<div class="row">

<div class="col-md-12">

{% if trait_slug and report_html == "" %}
<div class="progress">
  <div class="progress-bar progress-bar-success progress-bar-striped" role="progressbar"
  aria-valuenow="40" aria-valuemin="0" aria-valuemax="100" style="width:0%">
  </div>
</div>
{% endif %}

<div class="well">

</div>

  </div>
</div>


<div class="row">
      <div class="col-md-12">
          <ul>
            <li><strong>Submitted By: </strong></li>
           </ul>
            {{ report_html|safe }}
       </div>
</div>



{% endblock %}


{% block script %}
<script>


{% if trait_slug and report_html == "" %}
prog = Array()
prog[""] = "0%"
prog["Processing Phenotype Data"] = "10%"
prog["Performing Mapping"] = "20%"
prog["Processing Mapping"] = "60%"
prog["Plotting Figures"] = "75%"
prog["Processing Peaks"] = "80%"
prog["Transferring Data"] = "95%"
prog["complete"] = "100%"
prog["error"] = "100%"


var update_status = function(status) {
  $(".progress-bar").css("width", prog[status]).html(prog[status] + " (" + status + ")");
  if (status == "complete") {
    $(".progress").fadeOut();
    location.reload();
  }
  if (status == "error") {
    $(".progress-bar").addClass("progress-bar-danger").html("error");
  }
}

function check_status() {
  $.ajax({
     url:"/report_progress/",
     data: JSON.stringify({
            "report_slug": "{{ report_slug }}",
            "trait_slug": "{{ trait_slug }}" }),
     method: "POST",
     contentType: 'application/json;charset=UTF-8'
     }
     ).done(function(msg) {
      msg = JSON.parse(msg);
      update_status(msg);
    });
}

check_status();

window.setInterval(check_status, 5000);
{% endif %}

</script>
{% endblock %}
